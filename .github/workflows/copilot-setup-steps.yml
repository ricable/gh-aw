name: Copilot Setup Steps
"on":
  pull_request:
    paths:
    - .github/workflows/copilot-setup-steps.yml
  push:
    paths:
    - .github/workflows/copilot-setup-steps.yml
  workflow_dispatch: null
jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
    - name: Install gh-aw extension
      # To update the checksum after changing install-gh-aw.sh, run:
      #   sha256sum install-gh-aw.sh
      run: |
        curl -fsSL https://raw.githubusercontent.com/github/gh-aw/refs/heads/main/install-gh-aw.sh -o /tmp/gh-aw-install.sh
        echo "561f76eedd4b2c0448f21b0862a930784148ff4cc5491150f2bf5eb0bc6dd227  /tmp/gh-aw-install.sh" | sha256sum -c
        bash /tmp/gh-aw-install.sh
    - name: Checkout code
      uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd
    - name: Set up Node.js
      uses: actions/setup-node@395ad3262231945c25e8478fd5baf05154b1d79f
      with:
        cache: npm
        cache-dependency-path: actions/setup/js/package-lock.json
        node-version: "24"
    - name: Set up Go
      uses: actions/setup-go@d35c59abb061a4a6fb18e82ac0862c26744d6ab5
      with:
        cache: true
        go-version-file: go.mod
    - name: Install JavaScript dependencies
      run: cd actions/setup/js && npm ci
    - name: Install development dependencies
      run: make deps-dev
    - name: Build code
      run: make build
    - name: Recompile workflows
      run: make recompile
      env:
        GH_TOKEN: ${{ github.token }}
    - name: Install uv
      uses: astral-sh/setup-uv@eac588ad8def6316056a12d4907a9d4d84ff7a3b # v7.3.0
    - name: Install Go language server (gopls)
      run: go install golang.org/x/tools/gopls@latest
    - name: Install TypeScript language server
      run: npm install -g typescript-language-server typescript
