# Setup Action

This action copies workflow script files to the agent environment.

## Description

This action runs in all workflow jobs to provide scripts that can be used instead of being inlined in the workflow. This includes scripts for activation jobs, agent jobs, and safe-output jobs.

The action copies:
- 117 `.cjs` JavaScript files from the `js/` directory
- 7 `.sh` shell scripts from the `sh/` directory

All files are copied to the destination directory (default: `/tmp/gh-aw/actions`). These files are generated by running `make actions-build` and are committed to the repository.

## Usage

```yaml
- name: Setup Scripts
  uses: ./actions/setup
  with:
    # Destination directory for script files
    # Default: /tmp/gh-aw/actions
    destination: /tmp/gh-aw/actions
```

## Inputs

### `destination`

**Optional** Destination directory for script files.

Default: `/tmp/gh-aw/actions`

## Outputs

### `files-copied`

The number of files copied to the destination directory (should be 124: 117 JavaScript files + 7 shell scripts).

## Example

```yaml
steps:
  - uses: actions/checkout@v5
    with:
      sparse-checkout: |
        actions
  
  - name: Setup Scripts
    uses: ./actions/setup
    with:
      destination: /tmp/gh-aw/actions
```

## Files Included

This action copies files from `actions/setup/`, including:

### JavaScript Files (117 files from `js/`)
- Activation job scripts (check_stop_time, check_skip_if_match, check_command_position, etc.)
- Agent job scripts (compute_text, create_issue, create_pull_request, etc.)
- Safe output scripts (safe_outputs_*, safe_inputs_*, messages, etc.)
- Utility scripts (sanitize_*, validate_*, generate_*, etc.)

### Shell Scripts (6 files from `sh/`)
- `create_gh_aw_tmp_dir.sh` - Creates temporary directory structure
- `start_safe_inputs_server.sh` - Starts safe-inputs HTTP server
- `print_prompt_summary.sh` - Prints prompt summary to logs
- `create_cache_memory_dir.sh` - Creates cache-memory directory
- `create_prompt_first.sh` - Creates prompt directory
- `validate_multi_secret.sh` - Validates that at least one secret from a list is configured

All files are copied from the committed `js/` and `sh/` directories which contain the source of truth for all JavaScript and shell scripts.

## Development

The `js/` and `sh/` directories contain the source of truth for all JavaScript and shell script files. These files are manually edited and committed to the repository.

**To update JavaScript files:**

```bash
# Edit files in actions/setup/js/
# Format the JavaScript files
make fmt-cjs

# Lint the JavaScript files  
make lint-cjs

# Commit the changes
git add actions/setup/js/
git commit -m "Update JavaScript files"
```

**To update shell scripts:**

```bash
# Edit files in actions/setup/sh/
# Commit the changes
git add actions/setup/sh/
git commit -m "Update shell scripts"
```

**Note:** JavaScript and shell files are NOT embedded in the binary. They are copied at runtime by `setup.sh` from `actions/setup/js/` and `actions/setup/sh/` to `/tmp/gh-aw/actions` where workflows can access them.

## Testing Locally

You can test this action locally using the provided test script:

```bash
./test-setup-local.sh
```

This script will:
1. Check if `js/` directory exists (runs `make actions-build` if needed)
2. Run setup.sh with test configuration
3. Verify all files are copied correctly
